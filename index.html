<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booklet Processor - PDF Page Reordering Tool</title>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Document Processor</h1>
            <p>PDF booklet processing and EPUB cover updating</p>
        </header>

        <main>
            <!-- PDF Booklet Processing -->
            <div class="processing-type-selector">
                <h2>Choose Processing Type</h2>
                <div class="type-buttons">
                    <button id="pdfModeBtn" class="type-btn active">PDF Booklet</button>
                    <button id="epubModeBtn" class="type-btn">EPUB Cover</button>
                    <button id="pdfMergeBtn" class="type-btn">PDF Merger</button>
                    <button id="pdf2EpubBtn" class="type-btn">PDF â†’ EPUB</button>
                </div>
            </div>

            <!-- PDF Processing Section -->
            <div id="pdfProcessing" class="processing-section">
                <div class="upload-section">
                    <h2>1. Upload PDF</h2>
                    <div class="file-upload">
                        <input type="file" id="pdfFile" accept=".pdf" required>
                        <label for="pdfFile" class="file-label">
                            <span id="file-text">Choose PDF File</span>
                        </label>
                    </div>
                    <div id="file-info" class="file-info hidden"></div>
                </div>
            </div>

            <!-- EPUB Processing Section -->
            <div id="epubProcessing" class="processing-section hidden">
                <div class="upload-section">
                    <h2>1. Upload Files</h2>
                    <div class="epub-upload-grid">
                        <div class="file-upload">
                            <input type="file" id="epubFile" accept=".epub" required>
                            <label for="epubFile" class="file-label">
                                <span id="epub-file-text">Choose EPUB File</span>
                            </label>
                        </div>
                        <div class="file-upload">
                            <input type="file" id="coverFile" accept="image/*" required>
                            <label for="coverFile" class="file-label">
                                <span id="cover-file-text">Choose Cover Image</span>
                            </label>
                        </div>
                    </div>
                    <div id="epub-file-info" class="file-info hidden"></div>
                    <div id="cover-preview" class="cover-preview hidden"></div>
                </div>
            </div>

            <!-- PDF Merger Section -->
            <div id="pdfMergeProcessing" class="processing-section hidden">
                <div class="upload-section">
                    <h2>1. Upload PDF Files</h2>
                    <div class="file-upload">
                        <input type="file" id="mergeFiles" accept=".pdf" multiple required>
                        <label for="mergeFiles" class="file-label">
                            <span id="merge-file-text">Choose Multiple PDF Files</span>
                        </label>
                    </div>
                    <div id="merge-file-info" class="file-info hidden"></div>
                    <div id="pdf-list" class="pdf-list hidden"></div>
                </div>
            </div>

            <!-- PDF to EPUB Section -->
            <div id="pdf2EpubProcessing" class="processing-section hidden">
                <div class="upload-section">
                    <h2>1. Upload PDF and Metadata</h2>
                    <div class="file-upload">
                        <input type="file" id="pdf2epubFile" accept=".pdf" required>
                        <label for="pdf2epubFile" class="file-label">
                            <span id="pdf2epub-file-text">Choose PDF File</span>
                        </label>
                    </div>
                    <div id="pdf2epub-file-info" class="file-info hidden"></div>
                    <div id="epub-metadata" class="epub-metadata hidden">
                        <h3>EPUB Metadata</h3>
                        <div class="metadata-grid">
                            <div class="metadata-field">
                                <label for="epubTitle">Title:</label>
                                <input type="text" id="epubTitle" placeholder="Book Title" required>
                            </div>
                            <div class="metadata-field">
                                <label for="epubAuthor">Author:</label>
                                <input type="text" id="epubAuthor" placeholder="Author Name" required>
                            </div>
                            <div class="metadata-field">
                                <label for="epubLanguage">Language:</label>
                                <select id="epubLanguage">
                                    <option value="en">English</option>
                                    <option value="es">Spanish</option>
                                    <option value="fr">French</option>
                                    <option value="de">German</option>
                                    <option value="it">Italian</option>
                                    <option value="pt">Portuguese</option>
                                    <option value="ru">Russian</option>
                                    <option value="zh">Chinese</option>
                                    <option value="ja">Japanese</option>
                                </select>
                            </div>
                            <div class="metadata-field">
                                <label for="epubDescription">Description:</label>
                                <textarea id="epubDescription" placeholder="Book description..." rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PDF Configuration -->
            <div class="config-section hidden" id="pdfConfigSection">
                <h2>2. PDF Configuration</h2>
                
                <div class="config-group">
                    <label for="pagesPerSheet">Pages per Sheet:</label>
                    <select id="pagesPerSheet">
                        <option value="2">2 pages per sheet (standard duplex)</option>
                        <option value="4" selected>4 pages per sheet (cut horizontally)</option>
                    </select>
                </div>

                <div class="config-group">
                    <label for="signatureSize">Signature Size:</label>
                    <select id="signatureSize">
                        <option value="4">4 pages</option>
                        <option value="8">8 pages</option>
                        <option value="16" selected>16 pages</option>
                        <option value="32">32 pages</option>
                    </select>
                </div>

                <div class="config-group">
                    <label for="sewingMarks">Sewing Marks:</label>
                    <select id="sewingMarks">
                        <option value="none">No sewing marks</option>
                        <option value="4" selected>4 evenly spaced holes</option>
                        <option value="6">6 evenly spaced holes</option>
                        <option value="8">8 evenly spaced holes</option>
                    </select>
                </div>

                <div class="config-group">
                    <label for="cuttingLines">Cutting Lines:</label>
                    <select id="cuttingLines">
                        <option value="none">No cutting lines</option>
                        <option value="horizontal" selected>Horizontal cutting lines</option>
                        <option value="both">Horizontal and vertical cutting lines</option>
                    </select>
                </div>

                <button id="processPdfBtn" class="process-btn">Process PDF</button>
            </div>

            <!-- EPUB Configuration -->
            <div class="config-section hidden" id="epubConfigSection">
                <h2>2. EPUB Configuration</h2>
                
                <div class="config-group">
                    <p>The new cover image will replace the existing cover in your EPUB file. The image will be automatically resized and optimized for EPUB readers.</p>
                </div>

                <button id="processEpubBtn" class="process-btn">Update EPUB Cover</button>
            </div>

            <!-- PDF Merge Configuration -->
            <div class="config-section hidden" id="pdfMergeConfigSection">
                <h2>2. Merge Configuration</h2>
                
                <div class="config-group">
                    <p>PDF files will be merged in the order shown above. You can reorder files by dragging and dropping them in the list.</p>
                </div>

                <button id="processMergeBtn" class="process-btn">Merge PDF Files</button>
            </div>

            <!-- PDF to EPUB Configuration -->
            <div class="config-section hidden" id="pdf2EpubConfigSection">
                <h2>2. Conversion Configuration</h2>
                
                <div class="config-group">
                    <label for="pagesPerChapter">Pages per Chapter:</label>
                    <select id="pagesPerChapter">
                        <option value="1">1 page per chapter</option>
                        <option value="5">5 pages per chapter</option>
                        <option value="10" selected>10 pages per chapter</option>
                        <option value="20">20 pages per chapter</option>
                        <option value="all">All pages in one chapter</option>
                    </select>
                </div>

                <div class="config-group">
                    <p>The PDF will be converted to EPUB format with the metadata you provided. Each page will be converted to an image in the EPUB.</p>
                </div>

                <button id="processPdf2EpubBtn" class="process-btn">Convert PDF to EPUB</button>
            </div>

            <div class="progress-section hidden" id="progressSection">
                <h2>3. Processing</h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div id="progressText">Processing...</div>
            </div>

            <!-- PDF Results -->
            <div class="result-section hidden" id="pdfResultSection">
                <h2>4. Download Result</h2>
                <p>Your booklet has been processed successfully!</p>
                <button id="downloadPdfBtn" class="download-btn">Download Processed PDF</button>
                <div class="result-info">
                    <p><strong>Original pages:</strong> <span id="originalPages"></span></p>
                    <p><strong>Final pages:</strong> <span id="finalPages"></span></p>
                    <p><strong>Blank pages added:</strong> <span id="blankPages"></span></p>
                </div>
            </div>

            <!-- EPUB Results -->
            <div class="result-section hidden" id="epubResultSection">
                <h2>4. Download Result</h2>
                <p>Your EPUB cover has been updated successfully!</p>
                <button id="downloadEpubBtn" class="download-btn">Download Updated EPUB</button>
                <div class="result-info">
                    <p><strong>Original EPUB:</strong> <span id="originalEpubName"></span></p>
                    <p><strong>New cover:</strong> <span id="newCoverName"></span></p>
                    <p><strong>Cover format:</strong> <span id="coverFormat"></span></p>
                </div>
            </div>

            <!-- PDF Merge Results -->
            <div class="result-section hidden" id="pdfMergeResultSection">
                <h2>4. Download Result</h2>
                <p>Your PDF files have been merged successfully!</p>
                <button id="downloadMergeBtn" class="download-btn">Download Merged PDF</button>
                <div class="result-info">
                    <p><strong>Files merged:</strong> <span id="mergedFileCount"></span></p>
                    <p><strong>Total pages:</strong> <span id="totalMergedPages"></span></p>
                    <p><strong>Final size:</strong> <span id="mergedFileSize"></span></p>
                </div>
            </div>

            <!-- PDF to EPUB Results -->
            <div class="result-section hidden" id="pdf2EpubResultSection">
                <h2>4. Download Result</h2>
                <p>Your PDF has been converted to EPUB successfully!</p>
                <button id="downloadPdf2EpubBtn" class="download-btn">Download EPUB</button>
                <div class="result-info">
                    <p><strong>Original PDF:</strong> <span id="originalPdfName"></span></p>
                    <p><strong>EPUB title:</strong> <span id="convertedEpubTitle"></span></p>
                    <p><strong>Chapters created:</strong> <span id="chaptersCreated"></span></p>
                    <p><strong>Pages converted:</strong> <span id="pagesConverted"></span></p>
                </div>
            </div>
        </main>

        <footer>
            <div class="instructions">
                <h3>PDF Booklet Processing:</h3>
                <ol>
                    <li>Select "PDF Booklet" mode</li>
                    <li>Upload your PDF file</li>
                    <li>Choose printing configuration, signature size, sewing marks, and cutting lines</li>
                    <li>Process and download the reordered PDF with marks and guides</li>
                </ol>
                
                <h3>EPUB Cover Updating:</h3>
                <ol>
                    <li>Select "EPUB Cover" mode</li>
                    <li>Upload EPUB file and new cover image</li>
                    <li>Preview the new cover</li>
                    <li>Process and download updated EPUB</li>
                </ol>

                <h3>PDF Merger:</h3>
                <ol>
                    <li>Select "PDF Merger" mode</li>
                    <li>Upload multiple PDF files</li>
                    <li>Drag to reorder files as needed</li>
                    <li>Merge and download combined PDF</li>
                </ol>

                <h3>PDF to EPUB Conversion:</h3>
                <ol>
                    <li>Select "PDF â†’ EPUB" mode</li>
                    <li>Upload PDF and fill metadata fields</li>
                    <li>Choose chapter structure</li>
                    <li>Convert and download EPUB</li>
                </ol>
                
                <h3>PDF Printing Instructions:</h3>
                <ul>
                    <li><strong>4 pages per sheet:</strong> Print double-sided, long edge binding, then cut horizontally</li>
                    <li><strong>2 pages per sheet:</strong> Print double-sided, long edge binding, stack and fold</li>
                    <li><strong>Sewing Marks:</strong> Evenly spaced holes appear on fold edges for binding with thread or wire</li>
                    <li><strong>Cutting Lines:</strong> Dashed lines with CUT markers show where to cut pages horizontally</li>
                </ul>

                <h3>Supported Formats:</h3>
                <ul>
                    <li><strong>Input PDF:</strong> Any PDF file for processing/merging/conversion</li>
                    <li><strong>Input EPUB:</strong> Standard EPUB 2.0/3.0 files</li>
                    <li><strong>Cover Images:</strong> JPEG, PNG, GIF, WebP formats</li>
                    <li><strong>Output:</strong> PDF (booklet/merged) or EPUB (cover updated/converted)</li>
                </ul>
            </div>
        </footer>
    </div>

    <script src="booklet-processor.js"></script>
</body>
</html>